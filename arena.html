<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arena Photon Trade</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      background: #000;
      color: #ff69b4;
      font-family: monospace;
      padding: 2rem;
    }
    input, button {
      font-family: monospace;
      font-size: 1rem;
      margin: 0.3rem;
      padding: 0.5rem;
      border: 2px solid #ff69b4;
      background: #111;
      color: #ff69b4;
    }
    button:hover {
      background: #ff69b4;
      color: black;
    }
    #quoteDisplay {
      margin: 1rem 0;
      color: lime;
    }
    .slider-label {
      margin: 0.5rem 0 0 0;
    }
  </style>
</head>
<body>
  <h1>Arena Photon Trade</h1>
  <input id="customToken" placeholder="Token contract address">
  <input id="amount" placeholder="Amount">
  <input id="slippage" placeholder="Slippage %" value="2">

  <div class="slider-label">Max Fee (Gwei)</div>
  <input type="range" min="50" max="500" value="200" id="maxFeeSlider">
  <span id="maxFeeValue">200</span>

  <div class="slider-label">Priority Fee (Gwei)</div>
  <input type="range" min="1" max="50" value="2" id="priorityFeeSlider">
  <span id="priorityFeeValue">2</span>

  <button onclick="getQuote('buy')">Preview Buy</button>
  <button onclick="getQuote('sell')">Preview Sell</button>
  <button onclick="confirmTrade('buy')">Buy Now</button>
  <button onclick="confirmTrade('sell')">Sell Now</button>

  <div id="quoteDisplay">Quote: N/A</div>
  <div id="status"></div>

  <script>
    let provider, signer, userAddress;
    window.addEventListener('load', async () => {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
      }
    });

    document.getElementById("maxFeeSlider").oninput = function() {
      document.getElementById("maxFeeValue").textContent = this.value;
    }
    document.getElementById("priorityFeeSlider").oninput = function() {
      document.getElementById("priorityFeeValue").textContent = this.value;
    }

    async function getQuote(type) {
      const token = document.getElementById("customToken").value.trim();
      const amount = document.getElementById("amount").value.trim();
      const slippage = document.getElementById("slippage").value;
      const src = type === 'buy' ? "0x0000000000000000000000000000000000000000" : token;
      const dest = type === 'buy' ? token : "0x0000000000000000000000000000000000000000";

      try {
        const parsedAmount = ethers.utils.parseUnits(amount, 18).toString();
        const quoteUrl = `https://apiv5.paraswap.io/prices/?srcToken=${src}&destToken=${dest}&amount=${parsedAmount}&side=${type.toUpperCase()}&network=43114&slippage=${slippage}`;
        const res = await fetch(quoteUrl);
        const data = await res.json();
        document.getElementById("quoteDisplay").textContent = `Quote: ${data.destAmount / (10 ** 18)} tokens`;
      } catch (e) {
        document.getElementById("quoteDisplay").textContent = `Quote failed`;
      }
    }

    async function confirmTrade(type) {
      const token = document.getElementById("customToken").value.trim();
      const amount = document.getElementById("amount").value.trim();
      const slippage = parseFloat(document.getElementById("slippage").value);
      const maxFee = document.getElementById("maxFeeSlider").value;
      const priorityFee = document.getElementById("priorityFeeSlider").value;

      const srcToken = type === 'buy' ? "0x0000000000000000000000000000000000000000" : token;
      const destToken = type === 'buy' ? token : "0x0000000000000000000000000000000000000000";
      const srcAmount = ethers.utils.parseUnits(amount, 18).toString();

      try {
        const txRes = await fetch(`https://apiv5.paraswap.io/transactions/43114`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            srcToken,
            destToken,
            srcAmount,
            slippage,
            userAddress,
            partner: "arena-photon"
          })
        });
        const txData = await txRes.json();

        const tx = {
          to: txData.to,
          data: txData.data,
          value: ethers.BigNumber.from(txData.value || 0),
          gasLimit: ethers.BigNumber.from(500000),
          maxPriorityFeePerGas: ethers.utils.parseUnits(priorityFee, 'gwei'),
          maxFeePerGas: ethers.utils.parseUnits(maxFee, 'gwei')
        };

        const sentTx = await signer.sendTransaction(tx);
        document.getElementById("status").textContent = `Sent: ${sentTx.hash}`;
      } catch (err) {
        document.getElementById("status").textContent = `Error: ${err.message}`;
      }
    }
  </script>
</body>
</html>

